<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- ✅ Critical for responsiveness -->
    <title>به هنگام رسانی وظیفه</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Bootstrap RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" integrity="sha384-RWvIoBymqE+ZNyv4WjCh+E+FZd4L9QF8r9jkaG+hEEYX/7dU56Ns6WB6eAebfAy+" crossorigin="anonymous">

    <!-- Your custom styles (including Vazir font) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="container py-4 bg-light">
<div class="nav1">
    <div class="nav1 mb-3"><a href="/project/{{ project.id }}/kanban">برگشت به پروژه‌</a></div>

</div>
{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <div class="nav1 mb-3">
    <a href="{{ url_for('task_list', project_id=project.id) }}" class="btn btn-link nav1">برگشت به لیست وظایف</a>
  </div>

  <h2 class="mb-4">ویرایش وظیفه</h2>

  <form method="POST">
    {{ form.csrf_token }}
    {{ form.hidden_tag() }}

  <div class="mb-3">
    {{ form.column_id.label(class="form-label") }}
    {{ form.column_id(class="form-select") }}
  </div>

  <div class="mb-3">
      {{ form.title.label(class="form-label") }}
      {{ form.title(class="form-control", value=task.title) }}
    </div>

    <div class="mb-3">
      {{ form.description.label(class="form-label") }}
      {{ form.description(class="form-control", rows=3) }} 
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        {{ form.start_date(class="form-control", readonly="readonly", id="datepickerr", placeholder="تاریخ آغاز", autocomplete="off") }}
      </div>

      <div class="col-md-6 mb-3">
        {{ form.due_date(class="form-control", readonly="readonly", id="datepickerr2", placeholder="تاریخ پایان", autocomplete="off") }}
      </div>
    </div>

    <button type="submit" name="submit_task" class="btn btn-primary">ذخیره تغییرات</button>
    <a href="{{ url_for('task_list', project_id=project.id) }}" class="btn btn-secondary">انصراف</a>
  </form>
</div>

<script>
  kamaDatepicker('datepickerr', {
    nextButtonIcon: "fa fa-arrow-circle-right",
    previousButtonIcon: "fa fa-arrow-circle-left",
    forceFarsiDigits: true,
    markToday: true,
    highlightSelectedDay: true,
    gotoToday: true
  });

  kamaDatepicker('datepickerr2', {
    nextButtonIcon: "fa fa-arrow-circle-right",
    previousButtonIcon: "fa fa-arrow-circle-left",
    forceFarsiDigits: true,
    markToday: true,
    highlightSelectedDay: true,
    gotoToday: true
  });

</script>

<hr>
<h4>گزارش‌ها</h4>
<form method="POST">
    {{ report_form.hidden_tag() }}
    <div class="mb-3">
        {{ report_form.text.label }} {{ report_form.text(class="form-control") }}
    </div>
    <button type="submit" name="submit_report" class="btn btn-success">افزودن گزارش</button>
</form>

<ul class="list-group mt-4">
    {% for r in reports %}
        <li class="list-group-item d-flex justify-content-between">
            <div>
                <strong>{{ r.user.name, r.user.id }}</strong>:
                {{ r.text }}
                <br><small class="text-muted">{{ r.created_at }} :: {{ r.start_date }}</small>
            </div>
            {% if r.user_id == current_user.id %}
            <form method="POST" action="{{ url_for('kanban.delete_report', project_id=project.id, report_id=r.id) }}">
                <button class="btn btn-sm btn-danger">حذف</button>
            </form>
            {% endif %}
        </li>
    {% endfor %}
</ul>
{% endblock %}

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-gKZ84Kr84U/9B5qX7mdGOSFaInGkNpe8pEqFQxdJkKr6ZsEr/1OpI3UxF8zINJ9c" crossorigin="anonymous"></script>
</body>
</html>