<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ÙˆØ¸Ø§ÛŒÙ Ù¾Ø±ÙˆÚ˜Ù‡</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Bootstrap RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" integrity="sha384-RWvIoBymqE+ZNyv4WjCh+E+FZd4L9QF8r9jkaG+hEEYX/7dU56Ns6WB6eAebfAy+" crossorigin="anonymous">

    <!-- Ø³Ø¨Ú©â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="container py-4 bg-light">
<div class="nav1 mb-3"><a href="/projects">Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ ÙÙ‡Ø±Ø³Øª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</a></div>

{% extends 'base.html' %}
{% block content %}

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show mt-3" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Ø¨Ø³ØªÙ†"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="d-flex justify-content-between align-items-center mb-4 kanban_nav">
  <div>
    <h2>{{ project.title }}</h2>
    <p class="text-muted">{{ project.description }}</p>
  </div>
  <div style="display: flex;flex-direction: row;justify-content: end;">
  {% if current_user and current_user.id == project.creator_id %}
    <a href="#add-column-form" class="btn btn-outline-primary my-2">+ Ø§ÙØ²ÙˆØ¯Ù† Ø³ØªÙˆÙ†</a>
    <a href="{{ url_for('kanban.create_task', project_id=project.id) }}" class="btn btn-outline-primary my-2">+ Ø§ÙØ²ÙˆØ¯Ù† ÙˆØ¸ÛŒÙÙ‡</a>
    <a href="{{ url_for('kanban.gantt_chart', project_id=project.id) }}" class="btn btn-outline-primary my-2">ğŸ“Š Ù†Ù…ÙˆØ¯Ø§Ø± Ú¯Ø§Ù†Øª</a>
  {% endif %}
  </div>
</div>

<div class="row kanban-columns">
  {% for col in columns %}
    <div class="col-md-3 kanban-sec">
      <div class="card mb-4 kanban-sec-body">
        <div class="card-header d-flex justify-content-between align-items-center">
          <strong>{{ col.title }}</strong>
            <div class="btn-group btn-group-sm">
              <a class="btn  btn-sm" href="{{ url_for('assign_users_to_column', project_id=project.id, column_id=col.id) }}">
                  ğŸ‘¥
              </a>
              {% if current_user and current_user.id == project.creator_id %}
              <a href="{{ url_for('kanban.edit_column', project_id=project.id, column_id=col.id) }}" class="btn  btn-sm">âœï¸</a>
              <form method="POST" action="{{ url_for('kanban.delete_column', project_id=project.id, column_id=col.id) }}" onsubmit="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø³ØªÙˆÙ† Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')" style="display:inline;">
                <button type="submit" class="btn  btn-sm">ğŸ—‘ï¸</button>
              </form>
              {% endif %}
            </div>
        </div>
        <ul class="list-group list-group-flush">
          {% for task in tasks.get(col.id, []) %}
            <li class="kanban-tasks list-group-item ">
              <div class="task-text">{{ task.title }}</div>
              <div class="task-nav">
              <a alt="ØªØ®ØµÛŒØµ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†" title="ØªØ®ØµÛŒØµ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†" href="{{ url_for('assign_users_to_task', task_id=task.id) }}">
                ğŸ‘¥
              </a>
              <a href="{{ url_for('kanban.edit_task', project_id=project.id, task_id=task.id) }}" title="ÙˆÛŒØ±Ø§ÛŒØ´ ÙˆØ¸ÛŒÙÙ‡">
                âœï¸ 
              </a>
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  {% endfor %}
</div>

{% if current_user and current_user.id == project.creator_id %}
<hr>
<h4 id="add-column-form">Ø§ÙØ²ÙˆØ¯Ù† Ø³ØªÙˆÙ† Ø¬Ø¯ÛŒØ¯</h4>
<form method="POST" action="{{ url_for('kanban.add_column', project_id=project.id) }}">
  <div class="input-group mb-3">
    <input type="text" name="title" class="form-control" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø³ØªÙˆÙ† Ø¬Ø¯ÛŒØ¯" required>
    <button type="submit" class="btn btn-success">Ø§ÙØ²ÙˆØ¯Ù†</button>
  </div>
</form>
{% endif %}

{% endblock %}

<!-- Bootstrap Bundle JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-gKZ84Kr84U/9B5qX7mdGOSFaInGkNpe8pEqFQxdJkKr6ZsEr/1OpI3UxF8zINJ9c" crossorigin="anonymous"></script>
</body>
</html>
