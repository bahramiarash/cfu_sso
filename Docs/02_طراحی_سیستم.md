# Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø·Ø±Ø§Ø­ÛŒ Ø³ÛŒØ³ØªÙ… BI

## ğŸ“‹ ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨
1. [Ù…Ø¹Ù…Ø§Ø±ÛŒ Ú©Ù„ÛŒ Ø³ÛŒØ³ØªÙ…](#Ù…Ø¹Ù…Ø§Ø±ÛŒ-Ú©Ù„ÛŒ-Ø³ÛŒØ³ØªÙ…)
2. [Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù„Ø§ÛŒÙ‡â€ŒØ§ÛŒ](#Ù…Ø¹Ù…Ø§Ø±ÛŒ-Ù„Ø§ÛŒÙ‡â€ŒØ§ÛŒ)
3. [Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø·Ø±Ø§Ø­ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡](#Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ-Ø·Ø±Ø§Ø­ÛŒ-Ø§Ø³ØªÙØ§Ø¯Ù‡-Ø´Ø¯Ù‡)
4. [Ø³Ø§Ø®ØªØ§Ø± Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§](#Ø³Ø§Ø®ØªØ§Ø±-Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§)
5. [Ø¬Ø±ÛŒØ§Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§](#Ø¬Ø±ÛŒØ§Ù†-Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§)
6. [Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ùˆ Ø¬Ù„Ø³Ù‡](#Ù…Ø¯ÛŒØ±ÛŒØª-ÙˆØ¶Ø¹ÛŒØª-Ùˆ-Ø¬Ù„Ø³Ù‡)

---

## Ù…Ø¹Ù…Ø§Ø±ÛŒ Ú©Ù„ÛŒ Ø³ÛŒØ³ØªÙ…

### Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ

Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ ØµÙˆØ±Øª **Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³Ù‡ Ù„Ø§ÛŒÙ‡** Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Presentation Layer                    â”‚
â”‚  (Templates, Static Files, JavaScript)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Application Layer                     â”‚
â”‚  (Flask Routes, Business Logic, Controllers)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Data Layer                            â”‚
â”‚  (SQLAlchemy Models, Database, External APIs)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ø§Ø¬Ø²Ø§ÛŒ Ø§ØµÙ„ÛŒ

1. **Flask Application** (`app/app.py`)
   - Ù†Ù‚Ø·Ù‡ ÙˆØ±ÙˆØ¯ Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
   - ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ùˆ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ
   - Ø«Ø¨Øª Blueprintâ€ŒÙ‡Ø§

2. **Dashboard System** (`app/dashboards/`)
   - Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§
   - Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ú©Ù„Ø§Ø³
   - Registry Pattern Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø®ÙˆØ¯Ú©Ø§Ø±

3. **Admin Panel** (`app/admin/`)
   - Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ
   - Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§
   - Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§

4. **Authentication System** (`app/auth_utils.py`, `app/app.py`)
   - Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª SSO
   - Ù…Ø¯ÛŒØ±ÛŒØª Ø¬Ù„Ø³Ù‡
   - Ú©Ù†ØªØ±Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ

5. **Data Providers** (`app/dashboards/data_providers/`)
   - Ù„Ø§ÛŒÙ‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡
   - ÙÛŒÙ„ØªØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø± Ø§Ø³Ø§Ø³ context
   - Cache management

---

## Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù„Ø§ÛŒÙ‡â€ŒØ§ÛŒ

### 1. Ù„Ø§ÛŒÙ‡ Presentation

#### 1.1. Templates (Jinja2)
```
app/templates/
â”œâ”€â”€ base.html                    # Template Ù¾Ø§ÛŒÙ‡
â”œâ”€â”€ index.html                   # ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
â”œâ”€â”€ dashboard_list.html          # Ù„ÛŒØ³Øª Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§
â”œâ”€â”€ dashboards/                  # Templateâ€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§
â”‚   â”œâ”€â”€ d1.html
â”‚   â”œâ”€â”€ d2.html
â”‚   â”œâ”€â”€ d3.html
â”‚   â”œâ”€â”€ d7.html
â”‚   â”œâ”€â”€ d8.html
â”‚   â””â”€â”€ students_dashboard.html
â””â”€â”€ admin/                       # Templateâ€ŒÙ‡Ø§ÛŒ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª
    â”œâ”€â”€ index.html
    â”œâ”€â”€ users/
    â”œâ”€â”€ dashboard_access/
    â””â”€â”€ data_sync/
```

#### 1.2. Static Files
```
app/static/
â”œâ”€â”€ bootstrap.min.css            # Bootstrap RTL
â”œâ”€â”€ chart.js                    # Chart.js library
â”œâ”€â”€ plotly-3.0.1.min.js        # Plotly for maps
â”œâ”€â”€ jquery.min.js               # jQuery
â””â”€â”€ style.css                   # Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ
```

#### 1.3. JavaScript Components
- **Chart.js**: Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ø¢Ù…Ø§Ø±ÛŒ
- **Plotly**: Ø¨Ø±Ø§ÛŒ Ù†Ù‚Ø´Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ¹Ø§Ù…Ù„ÛŒ
- **Bootstrap**: Ø¨Ø±Ø§ÛŒ UI components
- **jQuery**: Ø¨Ø±Ø§ÛŒ AJAX Ùˆ DOM manipulation

---

### 2. Ù„Ø§ÛŒÙ‡ Application

#### 2.1. Flask Blueprints

```
app/
â”œâ”€â”€ app.py                      # Main application
â”œâ”€â”€ dashboard_routes.py         # Dashboard routes
â”œâ”€â”€ admin/
â”‚   â””â”€â”€ routes.py              # Admin panel routes
â”œâ”€â”€ kanban.py                   # Kanban board routes
â””â”€â”€ students_dashboard.py       # Students dashboard routes
```

#### 2.2. Dashboard Architecture

```
app/dashboards/
â”œâ”€â”€ base.py                     # BaseDashboard (Abstract Class)
â”œâ”€â”€ registry.py                 # DashboardRegistry (Singleton)
â”œâ”€â”€ context.py                  # UserContext & AccessLevel
â”œâ”€â”€ config.py                   # Configuration
â”œâ”€â”€ cache.py                    # Caching system
â”œâ”€â”€ api.py                      # Dashboard API endpoints
â”œâ”€â”€ data_providers/             # Data access layer
â”‚   â”œâ”€â”€ base.py                 # BaseDataProvider
â”‚   â”œâ”€â”€ faculty.py              # FacultyDataProvider
â”‚   â”œâ”€â”€ students.py             # StudentsDataProvider
â”‚   â””â”€â”€ lms.py                  # LMSDataProvider
â”œâ”€â”€ visualizations/            # Reusable visualizations
â”‚   â””â”€â”€ maps.py                 # Map visualizations
â””â”€â”€ dashboards/                 # Individual dashboards
    â”œâ”€â”€ faculty_stats.py        # d1
    â”œâ”€â”€ faculty_map.py          # d2
    â”œâ”€â”€ pardis_map.py           # d3
    â”œâ”€â”€ student_faculty_ratio.py # d7
    â”œâ”€â”€ lms_monitoring.py       # d8
    â””â”€â”€ students_dashboard.py   # students
```

#### 2.3. Admin Panel Architecture

```
app/admin/
â”œâ”€â”€ __init__.py                 # Blueprint registration
â”œâ”€â”€ routes.py                   # Admin routes
â”œâ”€â”€ utils.py                    # Admin utilities
â”œâ”€â”€ scheduler.py                # Auto-sync scheduler
â”œâ”€â”€ sync_handlers.py            # Data sync handlers
â””â”€â”€ sync_progress.py            # Sync progress tracking
```

---

### 3. Ù„Ø§ÛŒÙ‡ Data

#### 3.1. Database Models

```
app/
â”œâ”€â”€ models.py                   # Main models
â”‚   â”œâ”€â”€ User
â”‚   â”œâ”€â”€ Project
â”‚   â”œâ”€â”€ Task
â”‚   â”œâ”€â”€ KanbanColumn
â”‚   â””â”€â”€ AccessLevel
â””â”€â”€ admin_models.py             # Admin models
    â”œâ”€â”€ DashboardAccess
    â”œâ”€â”€ AccessLog
    â”œâ”€â”€ DataSync
    â””â”€â”€ DashboardConfig
```

#### 3.2. Database Schema

- **access_control.db**: Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ØŒ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ØŒ ÙˆØ¸Ø§ÛŒÙ
- **faculty_data.db**: Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ø´Ú©Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù†

---

## Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø·Ø±Ø§Ø­ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡

### 1. Registry Pattern

**Ø§Ø³ØªÙØ§Ø¯Ù‡**: Ø«Ø¨Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§

```python
# app/dashboards/registry.py
class DashboardRegistry:
    _dashboards: Dict[str, BaseDashboard] = {}
    
    @classmethod
    def register(cls, dashboard_class):
        instance = dashboard_class()
        cls._dashboards[instance.dashboard_id] = instance
        return dashboard_class
```

**Ù…Ø²Ø§ÛŒØ§**:
- Ø«Ø¨Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§
- Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹ Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§
- Ù…Ø¯ÛŒØ±ÛŒØª Ù…ØªÙ…Ø±Ú©Ø²

---

### 2. Template Method Pattern

**Ø§Ø³ØªÙØ§Ø¯Ù‡**: BaseDashboard Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§

```python
# app/dashboards/base.py
class BaseDashboard(ABC):
    @abstractmethod
    def get_data(self, context: UserContext, **kwargs):
        pass
    
    @abstractmethod
    def render(self, data: Dict, context: UserContext):
        pass
    
    def handle_request(self, user_context, **kwargs):
        # Template method
        context = get_user_context()
        data = self.get_data(context, **kwargs)
        return self.render(data, context)
```

**Ù…Ø²Ø§ÛŒØ§**:
- Ú©Ø¯ Ù…Ø´ØªØ±Ú© Ø¯Ø± Ú©Ù„Ø§Ø³ Ù¾Ø§ÛŒÙ‡
- Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±ÛŒ Ø¯Ø± Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ
- Ú©Ø§Ù‡Ø´ Ú©Ø¯Ù‡Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ

---

### 3. Strategy Pattern

**Ø§Ø³ØªÙØ§Ø¯Ù‡**: Data Providers Ø¨Ø±Ø§ÛŒ Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø®ØªÙ„Ù Ø¯Ø§Ø¯Ù‡

```python
# app/dashboards/data_providers/base.py
class BaseDataProvider(ABC):
    @abstractmethod
    def get_data(self, context: UserContext, **filters):
        pass

# app/dashboards/data_providers/faculty.py
class FacultyDataProvider(BaseDataProvider):
    def get_data(self, context: UserContext, **filters):
        # Implementation
        pass
```

**Ù…Ø²Ø§ÛŒØ§**:
- Ù‚Ø§Ø¨Ù„ÛŒØª ØªØ¹ÙˆÛŒØ¶ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…â€ŒÙ‡Ø§
- Ø¬Ø¯Ø§Ø³Ø§Ø²ÛŒ Ù…Ù†Ø·Ù‚ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡
- Ø§ÙØ²ÙˆØ¯Ù† Ù…Ù†Ø¨Ø¹ Ø¯Ø§Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¢Ø³Ø§Ù†

---

### 4. Factory Pattern

**Ø§Ø³ØªÙØ§Ø¯Ù‡**: Ø§ÛŒØ¬Ø§Ø¯ UserContext

```python
# app/dashboards/context.py
def get_user_context(user: Optional[User] = None) -> UserContext:
    if user is None:
        user = current_user
    user_info = session.get('user_info', {})
    return UserContext(user, user_info)
```

---

### 5. Singleton Pattern

**Ø§Ø³ØªÙØ§Ø¯Ù‡**: DashboardRegistry Ùˆ Cache

```python
# app/dashboards/registry.py
class DashboardRegistry:
    _dashboards: Dict[str, BaseDashboard] = {}  # Class variable (Singleton)
```

---

### 6. Decorator Pattern

**Ø§Ø³ØªÙØ§Ø¯Ù‡**: Authentication Ùˆ Authorization decorators

```python
# app/auth_utils.py
def requires_auth(f):
    @wraps(f)
    def decorated(*args, **kwargs):
        if "sso_token" not in session:
            return redirect(url_for("login"))
        return f(*args, **kwargs)
    return decorated

# app/admin/utils.py
def admin_required(f):
    @wraps(f)
    def decorated(*args, **kwargs):
        if not current_user.is_admin():
            abort(403)
        return f(*args, **kwargs)
    return decorated
```

---

## Ø³Ø§Ø®ØªØ§Ø± Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§

### 1. Ù…Ø§Ú˜ÙˆÙ„ Dashboard

#### 1.1. BaseDashboard

```python
class BaseDashboard(ABC):
    def __init__(self, dashboard_id, title, description):
        self.dashboard_id = dashboard_id
        self.title = title
        self.description = description
        self.cache_enabled = True
        self.cache_ttl = 300
    
    @abstractmethod
    def get_data(self, context, **kwargs):
        pass
    
    @abstractmethod
    def render(self, data, context):
        pass
    
    def handle_request(self, user_context, **kwargs):
        # Main request handler
        pass
    
    def check_access(self, context):
        # Access control
        pass
```

#### 1.2. Dashboard Implementation Example

```python
@DashboardRegistry.register
class FacultyStatsDashboard(BaseDashboard):
    dashboard_id = "d1"
    title = "Ø¢Ù…Ø§Ø± Ø¯Ø§Ù†Ø´Ú©Ø¯Ù‡â€ŒÙ‡Ø§"
    
    def __init__(self):
        super().__init__(self.dashboard_id, self.title, "Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ Ø¯Ø§Ù†Ø´Ú©Ø¯Ù‡â€ŒÙ‡Ø§")
        self.data_provider = FacultyDataProvider()
    
    def get_data(self, context, **filters):
        return self.data_provider.get_faculty_stats(context, **filters)
    
    def render(self, data, context):
        template_context = self.get_template_context(data, context)
        return render_template("dashboards/d1.html", **template_context)
```

---

### 2. Ù…Ø§Ú˜ÙˆÙ„ Data Provider

#### 2.1. BaseDataProvider

```python
class BaseDataProvider(ABC):
    def __init__(self):
        self.db_path = DashboardConfig.FACULTY_DB
    
    @abstractmethod
    def get_data(self, context: UserContext, **filters):
        pass
    
    def apply_context_filters(self, query, context):
        # Apply user context filters
        pass
```

#### 2.2. FacultyDataProvider

```python
class FacultyDataProvider(BaseDataProvider):
    def get_faculty_stats(self, context, **filters):
        # Get faculty statistics
        pass
    
    def get_faculty_by_province(self, context, **filters):
        # Get faculties by province
        pass
```

---

### 3. Ù…Ø§Ú˜ÙˆÙ„ Context

#### 3.1. UserContext

```python
class UserContext:
    def __init__(self, user, user_info):
        self.user = user
        self.user_info = user_info
        self.province_code = self._get_province_code()
        self.university_code = self._get_university_code()
        self.faculty_code = self._get_faculty_code()
        self.access_level = self._determine_access_level()
        self.data_filters = self._build_data_filters()
    
    def apply_filters(self, query_filters):
        # Apply user's access filters
        pass
```

---

### 4. Ù…Ø§Ú˜ÙˆÙ„ Admin

#### 4.1. Admin Routes

```python
@admin_bp.route('/users')
@login_required
@admin_required
def users_list():
    # List users
    pass

@admin_bp.route('/data-sync')
@login_required
@admin_required
def data_sync_list():
    # List data syncs
    pass
```

#### 4.2. Sync Handlers

```python
def run_lms_sync(user_id, sync_id, manual_sync=False):
    # Run LMS data sync
    pass

def run_sync_by_source(data_source, user_id, sync_id=None):
    # Run sync by data source
    pass
```

---

## Ø¬Ø±ÛŒØ§Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§

### 1. Ø¬Ø±ÛŒØ§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯

```
User Request
    â†“
Flask Route (dashboard_routes.py)
    â†“
DashboardRegistry.get(dashboard_id)
    â†“
Dashboard.handle_request()
    â†“
UserContext.get_user_context()
    â†“
Dashboard.check_access(context)
    â†“
Dashboard.get_data(context, filters)
    â†“
DataProvider.get_data(context, filters)
    â†“
Database Query (with context filters)
    â†“
Data Processing
    â†“
Cache.set(data)
    â†“
Dashboard.render(data, context)
    â†“
Template Rendering
    â†“
Response to User
```

### 2. Ø¬Ø±ÛŒØ§Ù† Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§

```
Scheduler Trigger (or Manual)
    â†“
Sync Handler (sync_handlers.py)
    â†“
DataSync Model (get config)
    â†“
API Request (to API Gateway)
    â†“
Data Processing
    â†“
Database Insert/Update
    â†“
Update DataSync Status
    â†“
Log Action (AccessLog)
```

### 3. Ø¬Ø±ÛŒØ§Ù† Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª

```
User â†’ /login
    â†“
Redirect to SSO
    â†“
SSO Authentication
    â†“
Callback to /authorized
    â†“
Get Access Token
    â†“
Get User Info
    â†“
Create/Update User in DB
    â†“
Create Session
    â†“
Set Flask-Login Session
    â†“
Redirect to Dashboard
```

---

## Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ùˆ Ø¬Ù„Ø³Ù‡

### 1. Session Management

#### 1.1. Flask Session
- **Type**: FileSystem
- **Storage**: `flask_session/`
- **Security**:
  - `SESSION_COOKIE_SECURE = True` (HTTPS only)
  - `SESSION_COOKIE_HTTPONLY = True` (No JS access)
  - `SESSION_COOKIE_SAMESITE = 'Lax'`

#### 1.2. Session Data
```python
session = {
    'sso_token': {...},           # OAuth token
    'user_info': {...},           # User info from SSO
    'access_level': [...],        # User access levels
    'oauth_state': '...',         # CSRF protection
    'user_id': 123                # Current user ID
}
```

### 2. Flask-Login

```python
@login_manager.user_loader
def load_user(user_id):
    return User.query.get(int(user_id))

# Usage
@login_required
def protected_route():
    user = current_user
    # ...
```

### 3. Context Variables

```python
@app.context_processor
def inject_dashboards():
    # Make dashboards available in all templates
    user_context = get_user_context()
    dashboards = DashboardRegistry.get_accessible_dashboards(user_context)
    return {
        'accessible_dashboards': dashboards,
        'user_context': user_context.to_dict()
    }
```

---

## Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§

### 1. Error Handling Strategy

```python
try:
    # Operation
except ValueError as e:
    # Authentication/Authorization error
    return render_template("error.html", error="..."), 403
except Exception as e:
    logger.error(f"Error: {e}", exc_info=True)
    return render_template("error.html", error="..."), 500
```

### 2. Logging

```python
import logging

logger = logging.getLogger(__name__)
logger.info("Info message")
logger.warning("Warning message")
logger.error("Error message", exc_info=True)
```

---

## ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØºÛŒÛŒØ±Ø§Øª

| ØªØ§Ø±ÛŒØ® | Ù†Ø³Ø®Ù‡ | ØªØºÛŒÛŒØ±Ø§Øª | Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡ |
|------|------|---------|----------|
| 1404/01/XX | 1.0 | Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø³ØªÙ†Ø¯ Ø§ÙˆÙ„ÛŒÙ‡ | ØªÛŒÙ… ØªÙˆØ³Ø¹Ù‡ |
