# ุชุญูู ุฌุงูุน ูพุฑูฺู ูพูู ูุฏุฑุช BI ู Kanban

## ๐ ุฎูุงุตู ุงุฌุฑุง

ุงู ูพุฑูฺู ฺฉ ูพูู ูุฏุฑุช ูุจุชู ุจุฑ Flask ุงุณุช ฺฉู ุดุงูู ุงุจุฒุงุฑูุง ูุฎุชูู ุงุฒ ุฌููู:
- **ุณุณุชู BI (Business Intelligence)**: ุฏุงุดุจูุฑุฏูุง ุชุญูู ุจุฑุง ุฏุงุฏูโูุง ุฏุงูุดฺฉุฏูุ ุฏุงูุดุฌูุงู ู LMS
- **ุณุณุชู ูุฏุฑุช ูพุฑูฺู Kanban**: ูุฏุฑุช ูพุฑูฺูโูุง ู ูุธุงู ุจู ุฑูุด Kanban
- **ุงุญุฑุงุฒ ููุช SSO**: ุงุณุชูุงุฏู ุงุฒ ุณุณุชู SSO ูุฑฺฉุฒ ุฏุงูุดฺฏุงู

---

## ๐๏ธ ูุนูุงุฑ ู ุณุงุฎุชุงุฑ ูพุฑูฺู

### ุชฺฉููููฺโูุง ุงุณุชูุงุฏู ุดุฏู:
- **Backend**: Flask 3.1.0
- **Database**: SQLite (ุฏู ุฏุชุงุจุณ ุฌุฏุงฺฏุงูู)
- **ORM**: SQLAlchemy 2.0.41
- **Authentication**: Authlib (OAuth2) + Flask-Login
- **Visualization**: Chart.js, Plotly, Matplotlib
- **Frontend**: Jinja2 Templates, Bootstrap RTL
- **Date Handling**: jdatetime (ุชููู ุดูุณ)

### ุณุงุฎุชุงุฑ ุฏุงุฑฺฉุชูุฑ:
```
app/
โโโ __init__.py
โโโ app.py                 # ูุงู ุงุตู ุงูพูฺฉุดู
โโโ models.py              # ูุฏูโูุง ุฏุชุงุจุณ
โโโ auth_utils.py          # ุชูุงุจุน ุงุญุฑุงุฒ ููุช
โโโ dashboard.py           # Blueprint ุฏุงุดุจูุฑุฏูุง BI
โโโ kanban.py              # Blueprint ุณุณุชู Kanban
โโโ students_dashboard.py  # Blueprint ุฏุงุดุจูุฑุฏ ุฏุงูุดุฌูุงู
โโโ tools.py               # Blueprint ุงุจุฒุงุฑูุง
โโโ forms.py               # ูุฑูโูุง WTForms
โโโ label_management.py    # ูุฏุฑุช ุจุฑฺุณุจโูุง
โโโ task_label_assignment.py # ุงุฎุชุตุงุต ุจุฑฺุณุจ ุจู ุชุณฺฉโูุง
โโโ send_sms.py            # ุงุฑุณุงู ูพุงูฺฉ
โโโ fetch_data/            # ูุงฺููโูุง ุฏุฑุงูุช ุฏุงุฏู
โ   โโโ faculty_main.py
โ   โโโ students_main.py
โ   โโโ lms.py
โ   โโโ zabbixsms.py
โโโ templates/             # ูุงูุจโูุง HTML
โโโ static/                # ูุงูโูุง ุงุณุชุงุชฺฉ
โโโ data/                  # ุฏุงุฏูโูุง ุฌุบุฑุงูุง (shapefile)
```

---

## ๐ ุณุณุชู ุงุญุฑุงุฒ ููุช (SSO)

### ูพุงุฏูโุณุงุฒ:
- ุงุณุชูุงุฏู ุงุฒ **Authlib** ุจุฑุง OAuth2
- ุงุชุตุงู ุจู SSO ูุฑฺฉุฒ: `https://sso.cfu.ac.ir`
- ุฐุฎุฑู ุชูฺฉู ุฏุฑ session
- ุงุณุชูุงุฏู ุงุฒ Flask-Login ุจุฑุง ูุฏุฑุช session

### ูุดฺฉูุงุช ุงููุช ุดูุงุณุง ุดุฏู:

1. **Hardcoded Credentials** (ุฎุท 93 ุฏุฑ app.py):
   ```python
   "client_secret": os.getenv("SSO_CLIENT_SECRET", "5r75G@t39!"),
   ```
   - ุฑูุฒ ุนุจูุฑ ุจู ุตูุฑุช hardcode ุฏุฑ ฺฉุฏ ูุฌูุฏ ุฏุงุฑุฏ
   - ุจุงุฏ ุงุฒ ูุชุบุฑูุง ูุญุท ุงุณุชูุงุฏู ุดูุฏ

2. **Access Control ุณุฎุชโฺฉุฏ ุดุฏู** (ุฎุท 237 ุฏุฑ app.py):
   ```python
   if username in ["bahrami", "khodarahmi", "asef", "hosseinnezhad", "p.mehrtash"]:
   ```
   - ูุณุช ฺฉุงุฑุจุฑุงู ูุฌุงุฒ ุจู ุตูุฑุช hardcode ุงุณุช
   - ุจุงุฏ ุงุฒ ุฏุชุงุจุณ ุง ุณุณุชู ูุฏุฑุช ููุด ุงุณุชูุงุฏู ุดูุฏ

3. **SMS Credentials** (ุฎุท 8-9 ุฏุฑ send_sms.py):
   ```python
   SMS_USER = "khodarahmi"
   SMS_PASS = "9909177"
   ```
   - ุงุทูุงุนุงุช ุงุญุฑุงุฒ ููุช SMS ุจู ุตูุฑุช hardcode ุงุณุช

4. **Secret Key** (ุฎุท 51 ุฏุฑ app.py):
   ```python
   app.secret_key = os.environ.get("SECRET_KEY", "your-secure-random-key")
   ```
   - ููุฏุงุฑ ูพุดโูุฑุถ ูุงุงูู ุงุณุช

### ุชูุตูโูุง ุงููุช:
- ุงุณุชูุงุฏู ุงุฒ `.env` ุจุฑุง ุชูุงู ุงุทูุงุนุงุช ุญุณุงุณ
- ูพุงุฏูโุณุงุฒ ุณุณุชู Role-Based Access Control (RBAC)
- ุงุณุชูุงุฏู ุงุฒ ูุชุบุฑูุง ูุญุท ุจุฑุง ุชูุงู credentials
- ูุนุงูโุณุงุฒ HTTPS ู ุชูุธูุงุช ุงููุช session

---

## ๐พ ุณุงุฎุชุงุฑ ุฏุชุงุจุณ

### ุฏุชุงุจุณโูุง ุงุณุชูุงุฏู ุดุฏู:

1. **access_control.db**: ูุฏุฑุช ฺฉุงุฑุจุฑุงูุ ูพุฑูฺูโูุง ู ุชุณฺฉโูุง
   - `users`: ฺฉุงุฑุจุฑุงู ุณุณุชู
   - `projects`: ูพุฑูฺูโูุง
   - `kanban_columns`: ุณุชููโูุง Kanban
   - `tasks`: ูุธุงู
   - `labels` ู `label_values`: ุจุฑฺุณุจโูุง
   - `task_label_assignments`: ุงุฎุชุตุงุต ุจุฑฺุณุจ ุจู ุชุณฺฉ
   - `reports`: ฺฏุฒุงุฑุดโูุง ุชุณฺฉโูุง
   - `task_assigned_users`: ุงุฑุชุจุงุท ฺูุฏ ุจู ฺูุฏ ุชุณฺฉ ู ฺฉุงุฑุจุฑ

2. **faculty_data.db**: ุฏุงุฏูโูุง ุฏุงูุดฺฉุฏู ู ุฏุงูุดุฌูุงู
   - `faculty`: ุงุทูุงุนุงุช ุงุนุถุง ูุฆุช ุนูู
   - `students`: ุงุทูุงุนุงุช ุฏุงูุดุฌูุงู
   - `monitor_data`: ุฏุงุฏูโูุง ูุงูุชูุฑูฺฏ LMS
   - `province`: ุงุทูุงุนุงุช ุงุณุชุงูโูุง
   - `pardis`: ุงุทูุงุนุงุช ูพุฑุฏุณโูุง

### ูุดฺฉูุงุช ุดูุงุณุง ุดุฏู:

1. **Hardcoded Paths**:
   ```python
   DB_PATH2 = "C:\\services\\cert2\\app\\fetch_data\\faculty_data.db"
   ```
   - ูุณุฑูุง ุฏุชุงุจุณ ุจู ุตูุฑุช hardcode ูุณุชูุฏ
   - ุจุงุฏ ุงุฒ ูุชุบุฑูุง ูุญุท ุงุณุชูุงุฏู ุดูุฏ

2. **ุนุฏู ุงุณุชูุงุฏู ุงุฒ Migration**:
   - Flask-Migrate ูุตุจ ุดุฏู ุงูุง ุงุณุชูุงุฏู ูุดุฏู
   - ุชุบุฑุงุช schema ุจู ุตูุฑุช ุฏุณุช ุงูุฌุงู ูโุดูุฏ

3. **Duplicate Database Connections**:
   - ุฏุฑ ุจุฑุฎ ูุงูโูุง ุงุชุตุงู ูุณุชูู ุจู SQLite ุงูุฌุงู ูโุดูุฏ
   - ุจุงุฏ ุงุฒ SQLAlchemy ORM ุงุณุชูุงุฏู ุดูุฏ

---

## ๐ ุณุณุชู BI (Business Intelligence)

### ุฏุงุดุจูุฑุฏูุง ููุฌูุฏ:

1. **d1 - ุฏุงุดุจูุฑุฏ ุงุนุถุง ูุฆุช ุนูู**:
   - ุชูุฒุน ุจุฑ ุงุณุงุณ ุฌูุณุช
   - ุชูุฒุน ุจุฑ ุงุณุงุณ ูุฑฺฉุฒ
   - ุชูุฒุน ุจุฑ ุงุณุงุณ ุฑุดุชู
   - ุชูุฒุน ุจุฑ ุงุณุงุณ ููุน ุงุณุชุฎุฏุงู
   - ูููุฏุงุฑูุง Pie ู Bar

2. **d2 - ููุดู ุชูุฒุน ุฌุบุฑุงูุง**:
   - ููุดู ุงุฑุงู ุจุง Pie Chart ุจุฑุง ูุฑ ุงุณุชุงู
   - ุชูุฒุน ุฌูุณุช ุงุนุถุง ูุฆุช ุนูู
   - ุงุณุชูุงุฏู ุงุฒ GeoPandas ู Matplotlib

3. **d3 - ููุดู ุชูุฒุน ูพุฑุฏุณโูุง**:
   - ููุงุด ูพุฑุฏุณโูุงุ ูุฑุงฺฉุฒ ู ุฏุงูุดฺฉุฏูโูุง ุฑู ููุดู

4. **d7 - ูุณุจุช ุฏุงูุดุฌู ุจู ุงุณุชุงุฏ**:
   - ูููุฏุงุฑ ูุณุจุช ุฏุงูุดุฌูุงู ุจู ุงุนุถุง ูุฆุช ุนูู
   - ุชูฺฉฺฉ ุจุฑ ุงุณุงุณ ููุทุน ุชุญุตู

5. **d8 - ูุงูุชูุฑูฺฏ LMS**:
   - ฺฉุงุฑุจุฑุงู ุขููุงู LMS
   - ฺฉูุงุณโูุง ุฏุฑ ุญุงู ุถุจุท Adobe
   - ุขุฒูููโูุง ุฏุฑ ุญุงู ุจุฑฺฏุฒุงุฑ
   - ุงุชุตุงู ุจู ุณุฑูุณ ูุงูุชูุฑูฺฏ (http://127.0.0.1:6000/metrics)

6. **Students Dashboard**:
   - ุขูุงุฑ ุฏุงูุดุฌูุงู ุจุฑ ุงุณุงุณ ุฌูุณุช
   - ุชูุฒุน ุจุฑ ุงุณุงุณ ุงุณุชุงู
   - ุชูุฒุน ุจุฑ ุงุณุงุณ ุฑุดุชู ู ููุทุน
   - ูููุฏุงุฑูุง ุฒูุงู

### ูุดฺฉูุงุช ุดูุงุณุง ุดุฏู:

1. **Hardcoded Service URL** (ุฎุท 771 ุฏุฑ app.py):
   ```python
   SERVICE_URL = "http://127.0.0.1:6000/metrics"
   ```
   - ุงุณุชูุงุฏู ุงุฒ HTTP ุจู ุฌุง HTTPS
   - ุขุฏุฑุณ localhost

2. **SMS Alert ุฏุฑ Loop** (ุฎุท 731-739 ุฏุฑ app.py):
   ```python
   for lms_user_count in data["values"]:
       if int(lms_user_count) >= 200:
           send_sms(...)
           break
   ```
   - ููฺฉู ุงุณุช ุจุฑุง ูุฑ ุฏุฑุฎูุงุณุช SMS ุงุฑุณุงู ุดูุฏ
   - ุจุงุฏ ุงุฒ ูฺฉุงูุฒู debounce ุงุณุชูุงุฏู ุดูุฏ

3. **ุนุฏู Cache ุจุฑุง Queryโูุง ุณูฺฏู**:
   - Queryโูุง ูพฺุฏู ุฏุฑ ูุฑ ุฏุฑุฎูุงุณุช ุงุฌุฑุง ูโุดููุฏ
   - ุจุงุฏ ุงุฒ cache ุงุณุชูุงุฏู ุดูุฏ

---

## ๐ ุณุณุชู Kanban

### ูฺฺฏโูุง:

1. **ูุฏุฑุช ูพุฑูฺูโูุง**:
   - ุงุฌุงุฏุ ูุฑุงุด ู ุญุฐู ูพุฑูฺู
   - ุงุฎุชุตุงุต ุงุนุถุง ุจู ูพุฑูฺู
   - ุชุนู owner ู creator

2. **ูุฏุฑุช ุณุชููโูุง Kanban**:
   - ุงุฌุงุฏ ุณุชููโูุง ุณูุงุฑุด
   - ูุฑุชุจโุณุงุฒ ุณุชููโูุง
   - ุงุฎุชุตุงุต ฺฉุงุฑุจุฑุงู ุจู ุณุชููโูุง

3. **ูุฏุฑุช ุชุณฺฉโูุง**:
   - ุงุฌุงุฏุ ูุฑุงุด ู ุญุฐู ุชุณฺฉ
   - ุงุฎุชุตุงุต ฺฉุงุฑุจุฑุงู ุจู ุชุณฺฉ
   - ุฌุงุจุฌุง ุชุณฺฉ ุจู ุณุชููโูุง
   - ุชุงุฑุฎ ุดุฑูุน ู ูพุงุงู (ูพุดุชุจุงู ุงุฒ ุชููู ุดูุณ)
   - ุณุณุชู ฺฏุฒุงุฑุดโุฏู ุจุฑุง ุชุณฺฉโูุง

4. **ุณุณุชู ุจุฑฺุณุจโฺฏุฐุงุฑ**:
   - ุงุฌุงุฏ ุจุฑฺุณุจโูุง ุณูุงุฑุด
   - ุงุฎุชุตุงุต ุจุฑฺุณุจ ุจู ุชุณฺฉโูุง
   - ููุงุฏุฑ ูุฎุชูู ุจุฑุง ูุฑ ุจุฑฺุณุจ

5. **ูููุฏุงุฑ ฺฏุงูุช**:
   - ููุงุด ุฒูุงู ูพุฑูฺูโูุง
   - ุชุจุฏู ุชุงุฑุฎ ุดูุณ ุจู ููุงุฏ
   - ุงุณุชูุงุฏู ุงุฒ Plotly

6. **Export ูพุฑูฺู**:
   - ุฎุฑูุฌ JSON ุงุฒ ูพุฑูฺู
   - ุดุงูู ุชูุงู ุชุณฺฉโูุงุ ุณุชููโูุง ู ฺฏุฒุงุฑุดโูุง

### ูุดฺฉูุงุช ุดูุงุณุง ุดุฏู:

1. **Inconsistent Permission Checks**:
   - ุฏุฑ ุจุฑุฎ routeโูุง ุงุฒ `@login_required` ุงุณุชูุงุฏู ุดุฏู
   - ุฏุฑ ุจุฑุฎ ุงุฒ `@requires_auth` ุงุณุชูุงุฏู ุดุฏู
   - ุจุงุฏ ฺฉุณุงูโุณุงุฒ ุดูุฏ

2. **Duplicate Code**:
   - ุชุงุจุน `convert_jalali_to_gregorian` ุฏุฑ ฺูุฏ ูุงู ุชฺฉุฑุงุฑ ุดุฏู
   - ุจุงุฏ ุฏุฑ ฺฉ ูุงฺูู ูุดุชุฑฺฉ ูุฑุงุฑ ฺฏุฑุฏ

3. **Missing Validation**:
   - ุนุฏู ุงุนุชุจุงุฑุณูุฌ ฺฉุงูู ูุฑูโูุง
   - ุนุฏู ุจุฑุฑุณ ูุญุฏูุฏุชโูุง ุชุงุฑุฎ

---

## ๐ง ูุดฺฉูุงุช ฺฉู ูพุฑูฺู

### 1. ฺฉุฏูุง ุชฺฉุฑุงุฑ ู ูุงูโูุง ูุฏู:
- ูุงูโูุง backup ู copy ุฏุฑ ูพุฑูฺู ูุฌูุฏ ุฏุงุฑุฏ:
  - `app - Copy.py`
  - `app copy14040625.py`
  - `dashboard copy.py`
  - ู ุบุฑู
- ุจุงุฏ ูพุงฺฉ ุดููุฏ

### 2. Logging:
- ุงุณุชูุงุฏู ุงุฒ `print` ุจู ุฌุง logging ุฏุฑ ุจุฑุฎ ุจุฎุดโูุง
- ุจุงุฏ ุงุฒ logging ุงุณุชุงูุฏุงุฑุฏ ุงุณุชูุงุฏู ุดูุฏ

### 3. Error Handling:
- ุนุฏู ูุฏุฑุช ุฎุทุง ุฏุฑ ุจุฑุฎ routeโูุง
- ุจุงุฏ try-except blocks ุงุถุงูู ุดูุฏ

### 4. Code Organization:
- ุจุฑุฎ routeโูุง ุฏุฑ `app.py` ูุณุชูุฏ ฺฉู ุจุงุฏ ุฏุฑ Blueprintโูุง ุจุงุดูุฏ
- ูุงู `app.py` ุฎู ุจุฒุฑฺฏ ุงุณุช (876 ุฎุท)

### 5. Configuration Management:
- ุชูุธูุงุช ุฏุฑ ฺูุฏ ุฌุง ูพุฑุงฺฉูุฏู ุงุณุช
- ุจุงุฏ ุฏุฑ `config.py` ูุชูุฑฺฉุฒ ุดูุฏ

### 6. Testing:
- ูฺ ุชุณุช ุฏุฑ ูพุฑูฺู ูุฌูุฏ ูุฏุงุฑุฏ
- ุจุงุฏ unit tests ู integration tests ุงุถุงูู ุดูุฏ

### 7. Documentation:
- ุนุฏู ูุฌูุฏ docstring ุจุฑุง ุชูุงุจุน
- ุนุฏู ูุฌูุฏ README ฺฉุงูู

---

## โ ููุงุท ููุช ูพุฑูฺู

1. **ุณุงุฎุชุงุฑ Blueprint**: ุงุณุชูุงุฏู ููุงุณุจ ุงุฒ Blueprint ุจุฑุง ุฌุฏุงุณุงุฒ ููุทู
2. **ูพุดุชุจุงู ุงุฒ ุชููู ุดูุณ**: ุงุณุชูุงุฏู ุงุฒ jdatetime
3. **UI/UX**: ุงุณุชูุงุฏู ุงุฒ Bootstrap RTL ู ูููุช ูุงุฑุณ
4. **ูุงุจูุชโูุง ูพุดุฑูุชู**: ูููุฏุงุฑ ฺฏุงูุชุ exportุ ููุดูโูุง ุฌุบุฑุงูุง
5. **ุณุณุชู ุจุฑฺุณุจโฺฏุฐุงุฑ**: ูุงุจูุช ุณูุงุฑุดโุณุงุฒ

---

## ๐ฏ ุชูุตูโูุง ุจูุจูุฏ

### ุงูููุช ุจุงูุง:

1. **ุงููุช**:
   - ุงูุชูุงู ุชูุงู credentials ุจู ูุชุบุฑูุง ูุญุท
   - ูพุงุฏูโุณุงุฒ RBAC
   - ุจุฑุฑุณ ู ุฑูุน ูุดฺฉูุงุช XSS ู CSRF

2. **ูพุงฺฉุณุงุฒ ฺฉุฏ**:
   - ุญุฐู ูุงูโูุง backup
   - Refactor ฺฉุฑุฏู `app.py`
   - ุญุฐู ฺฉุฏูุง ุชฺฉุฑุงุฑ

3. **ูุฏุฑุช ุฎุทุง**:
   - ุงุถุงูู ฺฉุฑุฏู error handling
   - ุงุณุชูุงุฏู ุงุฒ logging ุงุณุชุงูุฏุงุฑุฏ

### ุงูููุช ูุชูุณุท:

4. **ุจูุจูุฏ ุฏุชุงุจุณ**:
   - ุงุณุชูุงุฏู ุงุฒ Flask-Migrate
   - ุชุจุฏู hardcoded paths ุจู config
   - ุงุณุชูุงุฏู ุงุฒ connection pooling

5. **ุจูุจูุฏ Performance**:
   - ุงุถุงูู ฺฉุฑุฏู cache ุจุฑุง queryโูุง ุณูฺฏู
   - ุจูููโุณุงุฒ queryโูุง
   - ุงุณุชูุงุฏู ุงุฒ pagination

6. **Testing**:
   - ููุดุชู unit tests
   - ููุดุชู integration tests

### ุงูููุช ูพุงู:

7. **Documentation**:
   - ุงุถุงูู ฺฉุฑุฏู docstring
   - ููุดุชู README ฺฉุงูู
   - ูุณุชูุฏุณุงุฒ API

8. **CI/CD**:
   - ุฑุงูโุงูุฏุงุฒ CI/CD pipeline
   - Automated testing
   - Automated deployment

---

## ๐ ุขูุงุฑ ูพุฑูฺู

- **ุชุนุฏุงุฏ ูุงูโูุง Python**: ~20 ูุงู ุงุตู
- **ุฎุทูุท ฺฉุฏ**: ุชูุฑุจุงู 5000+ ุฎุท
- **Blueprintโูุง**: 5 (dashboard, kanban, students, tools, labels)
- **ูุฏูโูุง ุฏุชุงุจุณ**: 10+ ูุฏู
- **Routeโูุง**: 50+ endpoint
- **ุฏุงุดุจูุฑุฏูุง**: 6+ ุฏุงุดุจูุฑุฏ BI

---

## ๐ ูุชุฌูโฺฏุฑ

ูพุฑูฺู ฺฉ ุณุณุชู ุฌุงูุน ู ฺฉุงุฑุจุฑุฏ ุงุณุช ฺฉู ูุงุจูุชโูุง ุฎูุจ ุฏุงุฑุฏ ุงูุง ูุงุฒ ุจู ุจูุจูุฏ ุฏุฑ ุฒูููโูุง ุฒุฑ ุฏุงุฑุฏ:
- ุงููุช (ุงูููุช ุงูู)
- ูพุงฺฉุณุงุฒ ู ุณุงุฒูุงูุฏู ฺฉุฏ
- ูุฏุฑุช ุฎุทุง ู logging
- ุชุณุช ู ูุณุชูุฏุณุงุฒ

ุจุง ุฑูุน ูุดฺฉูุงุช ุงููุช ู ุจูุจูุฏ ุณุงุฎุชุงุฑ ฺฉุฏุ ุงู ูพุฑูฺู ูโุชูุงูุฏ ุจู ฺฉ ุณุณุชู production-ready ุชุจุฏู ุดูุฏ.

