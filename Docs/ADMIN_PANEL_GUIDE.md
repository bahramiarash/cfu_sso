# راهنمای پنل مدیریت

## مقدمه

پنل مدیریت یک سیستم حرفه‌ای برای مدیریت کامل داشبوردها، کاربران، دسترسی‌ها و همگام‌سازی داده است.

## ویژگی‌ها

### 1. مدیریت کاربران
- مشاهده لیست کاربران
- ایجاد کاربر جدید
- ویرایش اطلاعات کاربر
- مدیریت سطح دسترسی کاربران
- تنظیم محدودیت‌های سازمانی (استان، دانشگاه، دانشکده)

### 2. مدیریت دسترسی‌ها
- تعیین دسترسی کاربران به داشبوردهای خاص
- تنظیم فیلترهای دسترسی (محدودیت بر اساس استان، دانشگاه، دانشکده)
- تعیین بازه زمانی دسترسی

### 3. مشاهده لاگ‌ها
- مشاهده تمام اقدامات کاربران
- فیلتر بر اساس کاربر یا نوع اقدام
- مشاهده جزئیات کامل (IP، مسیر، زمان)

### 4. مدیریت همگام‌سازی داده
- مشاهده وضعیت همگام‌سازی داده از API Gateway
- تنظیم همگام‌سازی خودکار
- همگام‌سازی دستی
- مشاهده آخرین زمان همگام‌سازی (هجری شمسی)

### 5. تنظیمات داشبوردها
- فعال/غیرفعال کردن داشبوردها
- تنظیم عنوان و توضیحات
- تنظیم Cache TTL
- تنظیم بازه زمانی به‌روزرسانی خودکار

## نصب و راه‌اندازی

### 1. اجرای Migration

```bash
cd app/migrations
python create_admin_tables.py
```

### 2. دسترسی به پنل

پس از ورود به سیستم، کاربرانی که سطح دسترسی `admin` یا `staff` دارند می‌توانند به آدرس زیر دسترسی داشته باشند:

```
https://bi.cfu.ac.ir/admin
```

## استفاده

### مدیریت کاربران

1. از منوی سمت راست، "مدیریت کاربران" را انتخاب کنید
2. برای ایجاد کاربر جدید، روی دکمه "کاربر جدید" کلیک کنید
3. برای ویرایش کاربر، روی آیکون ویرایش در جدول کلیک کنید
4. سطح دسترسی کاربر را از طریق چک‌باکس‌ها تنظیم کنید

### مدیریت دسترسی‌ها

1. از منوی "مدیریت دسترسی‌ها" استفاده کنید
2. برای ایجاد دسترسی جدید، روی "دسترسی جدید" کلیک کنید
3. کاربر و داشبورد مورد نظر را انتخاب کنید
4. محدودیت‌های فیلتر را در صورت نیاز تنظیم کنید

### مشاهده لاگ‌ها

1. از منوی "مشاهده لاگ‌ها" استفاده کنید
2. می‌توانید بر اساس کاربر یا نوع اقدام فیلتر کنید
3. تمام اقدامات کاربران با جزئیات کامل نمایش داده می‌شود

### مدیریت همگام‌سازی

1. از منوی "همگام‌سازی داده" استفاده کنید
2. وضعیت هر منبع داده را مشاهده کنید
3. برای همگام‌سازی دستی، روی دکمه "همگام‌سازی" کلیک کنید
4. برای تنظیم همگام‌سازی خودکار، روی دکمه "تنظیمات" کلیک کنید

## امنیت

- تمام صفحات پنل مدیریت نیاز به احراز هویت دارند
- فقط کاربران با سطح دسترسی `admin` یا `staff` می‌توانند به پنل دسترسی داشته باشند
- تمام اقدامات در لاگ ثبت می‌شوند
- IP و User Agent کاربران ثبت می‌شود

## API Gateway Integration

برای اتصال به API Gateway، باید:

1. در جدول `data_syncs`، endpoint API را تنظیم کنید
2. روش همگام‌سازی (GET/POST) را مشخص کنید
3. پارامترهای مورد نیاز را در فیلد `api_params` تنظیم کنید
4. بازه زمانی همگام‌سازی خودکار را تنظیم کنید

## توسعه

برای اضافه کردن ویژگی‌های جدید:

1. مدل‌های جدید را در `app/admin_models.py` اضافه کنید
2. Routes جدید را در `app/admin/routes.py` اضافه کنید
3. Templates جدید را در `app/templates/admin/` اضافه کنید
4. از decorator `@admin_required` برای محافظت از routes استفاده کنید

