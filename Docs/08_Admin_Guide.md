# راهنمای ادمین - سامانه BI دانشگاه فرهنگیان

## 1. مقدمه

این راهنما نحوه استفاده از پنل مدیریتی سامانه BI را برای مدیران سیستم شرح می‌دهد.

## 2. دسترسی به پنل مدیریتی

### 2.1 ورود به پنل

1. با حساب Admin وارد سیستم شوید
2. پس از ورود، به صورت خودکار به پنل مدیریتی هدایت می‌شوید
3. یا به آدرس `/admin/` بروید

### 2.2 منوی پنل مدیریتی

پنل مدیریتی شامل بخش‌های زیر است:
- **داشبورد**: آمار کلی سیستم
- **کاربران**: مدیریت کاربران
- **دسترسی داشبوردها**: مدیریت دسترسی به داشبوردها
- **همگام‌سازی داده‌ها**: مدیریت همگام‌سازی
- **لاگ‌ها**: مشاهده لاگ فعالیت‌ها
- **تنظیمات داشبوردها**: مدیریت تنظیمات داشبوردها

## 3. مدیریت کاربران

### 3.1 لیست کاربران

برای مشاهده لیست کاربران:
1. از منوی پنل، روی "کاربران" کلیک کنید
2. یا به آدرس `/admin/users` بروید

**ویژگی‌ها**:
- جستجو در نام، SSO ID یا ایمیل
- صفحه‌بندی (20 کاربر در هر صفحه)
- مشاهده جزئیات کاربر

### 3.2 ایجاد کاربر جدید

1. از صفحه لیست کاربران، روی "ایجاد کاربر جدید" کلیک کنید
2. فرم ایجاد کاربر را پر کنید:
   - **نام**: نام کاربر
   - **SSO ID**: شناسه SSO (یکتا)
   - **ایمیل**: ایمیل کاربر (اختیاری)
   - **کد استان**: کد استان (اختیاری)
   - **کد دانشگاه**: کد دانشگاه (اختیاری)
   - **کد دانشکده**: کد دانشکده (اختیاری)
   - **سطوح دسترسی**: سطوح دسترسی کاربر را انتخاب کنید
     - `admin`: مدیر سیستم
     - `central_org`: سازمان مرکزی
     - `province_university`: دانشگاه استان
     - `faculty`: دانشکده
3. روی "ذخیره" کلیک کنید

**نکته**: SSO ID باید یکتا باشد. اگر کاربری با این SSO ID وجود داشته باشد، خطا نمایش داده می‌شود.

### 3.3 ویرایش کاربر

1. از لیست کاربران، روی کاربر مورد نظر کلیک کنید
2. روی "ویرایش" کلیک کنید
3. اطلاعات را تغییر دهید
4. روی "ذخیره" کلیک کنید

**قابل ویرایش**:
- نام
- ایمیل
- کد استان، دانشگاه و دانشکده
- سطوح دسترسی

### 3.4 مشاهده جزئیات کاربر

از صفحه لیست کاربران، روی کاربر مورد نظر کلیک کنید تا جزئیات نمایش داده شود:

**اطلاعات نمایش داده شده**:
- اطلاعات پایه کاربر
- دسترسی‌های داشبورد
- لاگ فعالیت‌های اخیر (20 مورد آخر)
- Context سازمانی کاربر

## 4. مدیریت دسترسی داشبوردها

### 4.1 لیست دسترسی‌ها

برای مشاهده لیست دسترسی‌ها:
1. از منوی پنل، روی "دسترسی داشبوردها" کلیک کنید
2. یا به آدرس `/admin/dashboard-access` بروید

### 4.2 ایجاد دسترسی جدید

1. از صفحه لیست دسترسی‌ها، روی "ایجاد دسترسی جدید" کلیک کنید
2. فرم را پر کنید:
   - **کاربر**: کاربر مورد نظر را انتخاب کنید
   - **داشبورد**: داشبورد مورد نظر را انتخاب کنید
   - **دسترسی**: آیا کاربر دسترسی دارد یا نه
   - **محدودیت فیلتر**: محدودیت‌های فیلتر را تعیین کنید (JSON)
     ```json
     {
       "province_codes": [1, 2, 3],
       "university_codes": [10],
       "faculty_codes": [100, 101]
     }
     ```
   - **تاریخ شروع**: تاریخ شروع دسترسی (اختیاری)
   - **تاریخ پایان**: تاریخ پایان دسترسی (اختیاری)
3. روی "ذخیره" کلیک کنید

### 4.3 ویرایش دسترسی

1. از لیست دسترسی‌ها، روی دسترسی مورد نظر کلیک کنید
2. روی "ویرایش" کلیک کنید
3. تنظیمات را تغییر دهید
4. روی "ذخیره" کلیک کنید

## 5. مدیریت همگام‌سازی داده‌ها

### 5.1 لیست همگام‌سازی‌ها

برای مشاهده لیست همگام‌سازی‌ها:
1. از منوی پنل، روی "همگام‌سازی داده‌ها" کلیک کنید
2. یا به آدرس `/admin/data-sync` بروید

**اطلاعات نمایش داده شده**:
- منبع داده (Faculty, Students, LMS)
- وضعیت (pending, running, success, failed)
- آخرین همگام‌سازی
- همگام‌سازی بعدی
- بازه زمانی
- تعداد رکوردهای همگام‌سازی شده

### 5.2 ویرایش تنظیمات همگام‌سازی

1. از لیست همگام‌سازی‌ها، روی همگام‌سازی مورد نظر کلیک کنید
2. روی "ویرایش" کلیک کنید
3. تنظیمات را تغییر دهید:

**تنظیمات عمومی**:
- **همگام‌سازی خودکار**: فعال/غیرفعال
- **بازه زمانی**: مقدار و واحد (دقیقه، ساعت، روز)

**تنظیمات API**:
- **API Base URL**: آدرس پایه API
- **API Endpoint**: آدرس کامل Endpoint
- **API Method**: متد HTTP (GET/POST)
- **API Username**: نام کاربری API
- **API Password**: رمز عبور API

4. روی "ذخیره" کلیک کنید

**نکته**: اگر رمز عبور را خالی بگذارید، رمز عبور قبلی حفظ می‌شود.

### 5.3 تست اتصال API

قبل از ذخیره تنظیمات، می‌توانید اتصال API را تست کنید:

1. در صفحه ویرایش همگام‌سازی، روی "تست اتصال" کلیک کنید
2. سیستم اتصال را تست می‌کند و نتیجه را نمایش می‌دهد

**نکات**:
- برای Faculty و Students، ابتدا Login تست می‌شود و سپس Endpoint
- برای LMS، فقط Endpoint تست می‌شود
- در صورت خطا، پیام خطای تفصیلی نمایش داده می‌شود

### 5.4 همگام‌سازی دستی

برای انجام همگام‌سازی دستی:
1. از لیست همگام‌سازی‌ها، روی همگام‌سازی مورد نظر کلیک کنید
2. روی "همگام‌سازی دستی" کلیک کنید
3. همگام‌سازی در پس‌زمینه شروع می‌شود

**نکته مهم برای LMS**:
- همگام‌سازی دستی LMS، همگام‌سازی مداوم را متوقف می‌کند
- پس از اتمام همگام‌سازی دستی، اگر همگام‌سازی خودکار فعال باشد، دوباره شروع می‌شود

### 5.5 توقف همگام‌سازی

برای توقف همگام‌سازی در حال اجرا:
1. از لیست همگام‌سازی‌ها، روی همگام‌سازی مورد نظر کلیک کنید
2. روی "توقف" کلیک کنید

**نکته**: فقط همگام‌سازی‌های در حال اجرا قابل توقف هستند.

### 5.6 راه‌اندازی مجدد همگام‌سازی

برای راه‌اندازی مجدد همگام‌سازی:
1. از لیست همگام‌سازی‌ها، روی همگام‌سازی مورد نظر کلیک کنید
2. روی "راه‌اندازی مجدد" کلیک کنید

این عمل همگام‌سازی را متوقف می‌کند (اگر در حال اجرا باشد) و سپس دوباره شروع می‌کند.

### 5.7 مشاهده پیشرفت همگام‌سازی

برای مشاهده پیشرفت همگام‌سازی:
1. از لیست همگام‌سازی‌ها، روی همگام‌سازی مورد نظر کلیک کنید
2. روی "مشاهده پیشرفت" کلیک کنید

**اطلاعات نمایش داده شده**:
- وضعیت (running, success, failed)
- درصد پیشرفت
- مرحله فعلی
- تعداد رکوردهای پردازش شده
- لاگ‌های همگام‌سازی

### 5.8 مدیریت Scheduler

Scheduler مسئول همگام‌سازی خودکار است:

**شروع Scheduler**:
1. از صفحه لیست همگام‌سازی‌ها، روی "شروع Scheduler" کلیک کنید

**توقف Scheduler**:
1. از صفحه لیست همگام‌سازی‌ها، روی "توقف Scheduler" کلیک کنید

**نکته**: Scheduler به صورت خودکار در زمان راه‌اندازی سیستم شروع می‌شود.

### 5.9 مشاهده لاگ همگام‌سازی

برای مشاهده لاگ همگام‌سازی:
1. از منوی پنل، روی "لاگ همگام‌سازی" کلیک کنید
2. یا به آدرس `/admin/data-sync/logs` بروید

**اطلاعات نمایش داده شده**:
- تاریخ و زمان
- کاربر
- نوع عمل
- جزئیات

## 6. مشاهده لاگ‌ها

### 6.1 لیست لاگ‌ها

برای مشاهده لیست لاگ‌ها:
1. از منوی پنل، روی "لاگ‌ها" کلیک کنید
2. یا به آدرس `/admin/logs` بروید

**فیلترها**:
- فیلتر بر اساس کاربر
- فیلتر بر اساس نوع عمل

**اطلاعات نمایش داده شده**:
- تاریخ و زمان (شمسی)
- کاربر
- نوع عمل
- منبع
- شناسه منبع
- آدرس IP
- مسیر درخواست

### 6.2 انواع لاگ‌ها

**لاگ‌های کاربری**:
- `view_dashboard`: مشاهده داشبورد
- `export_data`: خروجی داده

**لاگ‌های مدیریتی**:
- `create_user`: ایجاد کاربر
- `modify_user`: تغییر کاربر
- `create_dashboard_access`: ایجاد دسترسی
- `modify_dashboard_access`: تغییر دسترسی

**لاگ‌های همگام‌سازی**:
- `trigger_data_sync`: همگام‌سازی دستی
- `auto_sync_started`: شروع همگام‌سازی خودکار
- `auto_sync_completed`: اتمام همگام‌سازی خودکار
- `auto_sync_failed`: خطا در همگام‌سازی

## 7. مدیریت تنظیمات داشبوردها

### 7.1 لیست داشبوردها

برای مشاهده لیست داشبوردها:
1. از منوی پنل، روی "تنظیمات داشبوردها" کلیک کنید
2. یا به آدرس `/admin/dashboards` بروید

### 7.2 ویرایش تنظیمات داشبورد

1. از لیست داشبوردها، روی داشبورد مورد نظر کلیک کنید
2. روی "ویرایش تنظیمات" کلیک کنید
3. تنظیمات را تغییر دهید:

**تنظیمات نمایش**:
- **عنوان**: عنوان داشبورد
- **توضیحات**: توضیحات داشبورد
- **آیکون**: آیکون داشبورد
- **ترتیب**: ترتیب نمایش در لیست

**تنظیمات دسترسی**:
- **فعال**: فعال/غیرفعال بودن داشبورد
- **عمومی**: عمومی بودن داشبورد (قابل مشاهده برای همه)

**تنظیمات Cache**:
- **Cache TTL**: زمان Cache (ثانیه)
- **بازه به‌روزرسانی**: بازه به‌روزرسانی خودکار (ثانیه)

4. روی "ذخیره" کلیک کنید

## 8. داشبورد مدیریتی

صفحه اصلی پنل مدیریتی شامل آمار کلی سیستم است:

**آمار نمایش داده شده**:
- تعداد کل کاربران
- تعداد کل داشبوردها
- تعداد کل لاگ‌ها
- تعداد همگام‌سازی‌های فعال

**اطلاعات اضافی**:
- لاگ‌های اخیر (10 مورد آخر)
- وضعیت همگام‌سازی‌ها

## 9. نکات مهم

### 9.1 امنیت

- هرگز اطلاعات حساس (مثل رمز عبور API) را در لاگ‌ها ثبت نکنید
- دسترسی Admin را فقط به کاربران مورد اعتماد بدهید
- به صورت منظم لاگ‌ها را بررسی کنید

### 9.2 همگام‌سازی

- قبل از تغییر تنظیمات همگام‌سازی، اتصال API را تست کنید
- برای LMS، همگام‌سازی مداوم و دستی نمی‌توانند همزمان اجرا شوند
- در صورت خطا در همگام‌سازی، لاگ‌ها را بررسی کنید

### 9.3 عملکرد

- Cache TTL را بر اساس نیاز تنظیم کنید
- برای داده‌های Real-time (مثل LMS)، Cache TTL را کم کنید
- برای داده‌های Static، Cache TTL را زیاد کنید

## 10. مشکلات رایج

### 10.1 همگام‌سازی انجام نمی‌شود

**راه‌حل**:
- بررسی کنید که تنظیمات API صحیح است
- اتصال API را تست کنید
- بررسی کنید که Scheduler در حال اجرا است
- لاگ‌ها را بررسی کنید

### 10.2 کاربر نمی‌تواند به داشبورد دسترسی داشته باشد

**راه‌حل**:
- بررسی کنید که دسترسی کاربر به داشبورد تعریف شده است
- بررسی کنید که محدودیت‌های فیلتر درست تنظیم شده‌اند
- بررسی کنید که سطح دسترسی کاربر مناسب است

### 10.3 داده‌ها به‌روز نیستند

**راه‌حل**:
- بررسی کنید که همگام‌سازی به درستی انجام می‌شود
- Cache را پاک کنید
- همگام‌سازی دستی انجام دهید

---

**تاریخ ایجاد**: 1404  
**آخرین به‌روزرسانی**: 1404

